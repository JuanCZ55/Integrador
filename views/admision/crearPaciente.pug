extends ../layout.pug
include ../mixins.pug
block navbar
  include ../mixinsNavbar.pug
  +navbarAdmision
  
block main
  
  +debug(locals.paciente)

  .w-75.container
    +alert(mensajeAlert,alertClass)
  //- .alert.alert-danger(role="alert")
  //-   | #{mensajeAlert || ""}
  div.container-md.border.border-2.border-dark.rounded-3.d-flex.justify-content-center.align-items-center.form-box
    form.p-4(novalidate, action="/admision/crearPaciente", method="POST")
      .d-flex.align-items-center.mb-3
        h2.mx-auto.mb-0 Admision
        button.btn.btn-secondary.ms-auto(type="button", id="btn-autocompletar") Autocompletar Emergencia
      br
      .row
        .col
          .mb-3
            input(type="number", name="id_persona", value=(paciente && paciente.id_persona) || "", hidden)
            label.form-label(for="dni") DNI*
            input.form-control(type="number", id="dni", placeholder="48455713", value=(paciente && paciente.dni) || dni || "", name="dni")
            input.d-none(type="checkbox", name="emergencia",id="emergencia")
          .mb-3
            label.form-label(for="nombre") Nombre*
            input.form-control(type="text", id="nombre", placeholder="Juan Carlos", value=(paciente && paciente.nombre) || "", name="nombre")

          .mb-3
            label.form-label(for="apellido") Apellido*
            input.form-control(type="text", id="apellido", placeholder="Sosa Perez", value=(paciente && paciente.apellido) || "", name="apellido")
            
          .mb-3
            label.form-label(for="f_nacimiento") Fecha de Nacimiento*
            input.form-control(type="date", id="f_nacimiento",value=(paciente && paciente.f_nacimiento) || "", name="f_nacimiento")

          .mb-3
            label.form-label Genero*
            select.form-select(name="genero",id="genero")
              option(value="femenino", selected=(paciente && paciente.genero === "femenino")) Femenino
              option(value="masculino", selected=(paciente && paciente.genero === "masculino")) Masculino
              option(value="otro", selected=(paciente && paciente.genero === "otro")) Otro
          .mb-3
            label.form-label(for="direccion") Direccion*
            input.form-control(type="text", id="direccion", placeholder="Av. San Martin 1234", value=(paciente && paciente.direccion) || "", name="direccion")
        .col      
          .mb-3
            label.form-label(for="telefono") Telefono
            input.form-control(type="tel", id="telefono", placeholder="2665451236", value=(paciente && paciente.telefono) || "", name="telefono")

          .mb-3
            label.form-label(for="contacto") Telefono Contacto
            input.form-control(type="tel", id="contacto", placeholder="2665451236", value=(paciente && paciente.contacto) || "", name="contacto")

          .mb-3
            label.form-label(for="mail") Email
            input.form-control(type="mail", id="mail", placeholder="usuario@mail.com", value=(paciente && paciente.mail) || "", name="mail")


          .mb-3
            +select("id_obra_social",arregloObraSociales,id_obra_social, "Obra Social")

          .mb-3
            label.form-label(for="cod_os") Numero Obra Social*
            input.form-control(type="text", id="cod_os", placeholder="OS1234", value=(paciente && paciente.cod_os) || "", name="cod_os")

          .mb-3
            label.form-label Detalle
            textarea.form-control(id="detalle", rows="3", placeholder="Escriba un mensaje", name="detalle")= (paciente && paciente.detalle) || ""

        br
      .d-flex.justify-content-between
        button.btn.btn-primary(type="submit", onclick="this.form.action='/admision/crearPaciente'") Crear Paciente
        button.btn.btn-primary(type="submit", onclick="this.form.action='/admision/modificarPaciente'") Modificar Paciente
  script.
    let dniEmergencia = !{JSON.stringify(dniEmergencia)} // DNI de emergencia

    document.getElementById('btn-autocompletar').addEventListener('click', function() {
      document.getElementById('dni').value = dniEmergencia;
      document.getElementById('emergencia').checked = true; 
      console.log(document.getElementById('emergencia').value+"hola")
      document.getElementById('nombre').value = 'Paciente';
      document.getElementById('apellido').value = 'Emergencia';
      document.getElementById('f_nacimiento').value = '2000-01-01';
      document.getElementById('genero').value = 'otro';
      document.getElementById('direccion').value = 'Desconocida';
      document.getElementById('telefono').value = '';
      document.getElementById('contacto').value = '';
      document.getElementById('mail').value = '';
      // Obra social: selecciona la opción vacía o la primera
      let obraSocial = document.getElementById('id_obra_social');
      if (obraSocial) obraSocial.selectedIndex = 0;
      document.getElementById('cod_os').value = dniEmergencia;
      document.getElementById('detalle').value = 'Ingreso por emergencia';
    });